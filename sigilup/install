#!/usr/bin/env bash
# Sigilup installer
# curl -L https://sigil.sh | bash

set -eo pipefail

SIGILUP_DIR="${SIGILUP_DIR:-$HOME/.sigil}"
SIGILUP_BIN_DIR="$SIGILUP_DIR/bin"

main() {
    echo "Installing sigilup..."

    # Create directories
    mkdir -p "$SIGILUP_BIN_DIR"

    # Download sigilup
    local sigilup_url="https://cdn.jsdelivr.net/gh/0xHoneyJar/sigil@main/sigilup/sigilup"

    if ! curl -fsSL "$sigilup_url" -o "$SIGILUP_BIN_DIR/sigilup"; then
        echo "Failed to download sigilup"
        exit 1
    fi

    chmod +x "$SIGILUP_BIN_DIR/sigilup"

    echo ""
    echo "sigilup installed to $SIGILUP_BIN_DIR/sigilup"
    echo ""

    # Detect shell and provide instructions
    local shell_profile=""
    case "$SHELL" in
        */zsh)  shell_profile="$HOME/.zshrc" ;;
        */bash) shell_profile="$HOME/.bashrc" ;;
        */fish) shell_profile="$HOME/.config/fish/config.fish" ;;
        *)      shell_profile="$HOME/.profile" ;;
    esac

    # Check if already in PATH
    if [[ ":$PATH:" != *":$SIGILUP_BIN_DIR:"* ]]; then
        echo "Add sigilup to your PATH by running:"
        echo ""

        if [[ "$SHELL" == */fish ]]; then
            echo "  fish_add_path $SIGILUP_BIN_DIR"
        else
            echo "  echo 'export PATH=\"\$HOME/.sigil/bin:\$PATH\"' >> $shell_profile"
        fi

        echo ""
        echo "Then restart your terminal or run:"
        echo ""
        echo "  source $shell_profile"
        echo ""
    fi

    echo "Run 'sigilup' to install Sigil CLIs (anchor, lens)"
}

main "$@"
